/* SPDX-License-Identifier: MIT */
/*
 * Author: Andreas Werner <kernel@andy89.org>
 * Date: 2021
 */
#define SBICALL_FUNC(func, fid, ext) \
        .global func; \
        .type func, @function; \
        func:; \
	li a6, fid; \
	li a7, ext; \
	ecall; \
	ret; \
        .size func, . - func;

#define SBI_GET_SBI_SPEC_VERSION_FID 0
#define SBI_GET_SBI_SPEC_VERSION_EXT 0x10
#define SBI_GET_SBI_IMPL_ID_FID 1
#define SBI_GET_SBI_IMPL_ID_EXT 0x10
#define SBI_GET_SBI_IMPL_VERSION_FID 2
#define SBI_GET_SBI_IMPL_VERSION_EXT 0x10
#define SBI_PROBE_EXTENSION_FID 3
#define SBI_PROBE_EXTENSION_EXT 0x10
#define SBI_GET_MVENDORID_FID 4
#define SBI_GET_MVENDORID_EXT 0x10
#define SBI_GET_MARCHID_FID 5
#define SBI_GET_MARCHID_EXT 0x10
#define SBI_GET_MIMPID_FID 6
#define SBI_GET_MIMPID_EXT 0x10
#define SBI_SET_TIMER_FID 0
#define SBI_SET_TIMER_EXT 0x00
#define SBI_CONSOLE_PUTCHAR_FID 0
#define SBI_CONSOLE_PUTCHAR_EXT 0x01
#define SBI_CONSOLE_GETCHAR_FID 0
#define SBI_CONSOLE_GETCHAR_EXT 0x02
#define SBI_CLEAR_IPI_FID 0
#define SBI_CLEAR_IPI_EXT 0x03
#define SBI_SEND_IPI_FID 0
#define SBI_SEND_IPI_EXT 0x04
#define SBI_SHUTDOWN_FID 0
#define SBI_SHUTDOWN_EXT 0x08
#define SBI_REMOTE_HFENCE_GVMA_VMID_FID 3
#define SBI_REMOTE_HFENCE_GVMA_VMID_EXT 0x52464E43
#define SBI_REMOTE_HFENCE_GVMA_FID 4
#define SBI_REMOTE_HFENCE_GVMA_EXT 0x52464E43
#define SBI_REMOTE_HFENCE_VVMA_ASID_FID 5
#define SBI_REMOTE_HFENCE_VVMA_ASID_EXT 0x52464E43
#define SBI_REMOTE_HFENCE_VVMA_FID 6
#define SBI_REMOTE_HFENCE_VVMA_EXT 0x52464E43
#define SBI_HART_START_FID 0
#define SBI_HART_START_EXT 0x48534D
#define SBI_HART_STOP_FID 1
#define SBI_HART_STOP_EXT 0x48534D
#define SBI_HART_GET_STATUS_FID 2
#define SBI_HART_GET_STATUS_EXT 0x48534D
#define SBI_GET_SBI_SPEC_VERSION_FID 0
#define SBI_GET_SBI_SPEC_VERSION_EXT 0x10
#define SBI_GET_SBI_IMPL_ID_FID 1
#define SBI_GET_SBI_IMPL_ID_EXT 0x10
#define SBI_GET_SBI_IMPL_VERSION_FID 2
#define SBI_GET_SBI_IMPL_VERSION_EXT 0x10
#define SBI_PROBE_EXTENSION_FID 3
#define SBI_PROBE_EXTENSION_EXT 0x10
#define SBI_GET_MVENDORID_FID 4
#define SBI_GET_MVENDORID_EXT 0x10
#define SBI_GET_MARCHID_FID 5
#define SBI_GET_MARCHID_EXT 0x10
#define SBI_GET_MIMPID_FID 6
#define SBI_GET_MIMPID_EXT 0x10

#ifndef CONFIG_SBI_RFENCE_EXTENSION
#define SBI_REMOTE_FENCE_I_FID 0
#define SBI_REMOTE_FENCE_I_EXT 0x05
#define SBI_REMOTE_SFENCE_VMA_FID 0
#define SBI_REMOTE_SFENCE_VMA_EXT 0x06
#define SBI_REMOTE_SFENCE_VMA_ASID_FID 0
#define SBI_REMOTE_SFENCE_VMA_ASID_EXT 0x07
#else
#define SBI_REMOTE_FENCE_I_FID 0
#define SBI_REMOTE_FENCE_I_EXT 0x52464E43
#define SBI_REMOTE_SFENCE_VMA_FID 1
#define SBI_REMOTE_SFENCE_VMA_EXT 0x52464E43
#define SBI_REMOTE_SFENCE_VMA_ASID_FID 2
#define SBI_REMOTE_SFENCE_VMA_ASID_EXT 0x52464E43
#endif

SBICALL_FUNC(sbi_get_sbi_spec_version, SBI_GET_SBI_SPEC_VERSION_FID, SBI_GET_SBI_SPEC_VERSION_EXT)
SBICALL_FUNC(sbi_get_sbi_impl_id, SBI_GET_SBI_IMPL_ID_FID, SBI_GET_SBI_IMPL_ID_EXT)
SBICALL_FUNC(sbi_get_sbi_impl_version, SBI_GET_SBI_IMPL_VERSION_FID, SBI_GET_SBI_IMPL_VERSION_EXT)
SBICALL_FUNC(sbi_probe_extension, SBI_PROBE_EXTENSION_FID, SBI_PROBE_EXTENSION_EXT)
SBICALL_FUNC(sbi_get_mvendorid, SBI_GET_MVENDORID_FID, SBI_GET_MVENDORID_EXT)
SBICALL_FUNC(sbi_get_marchid, SBI_GET_MARCHID_FID, SBI_GET_MARCHID_EXT)
SBICALL_FUNC(sbi_get_mimpid, SBI_GET_MIMPID_FID, SBI_GET_MIMPID_EXT)
SBICALL_FUNC(sbi_set_timer, SBI_SET_TIMER_FID, SBI_SET_TIMER_EXT)
SBICALL_FUNC(sbi_console_putchar, SBI_CONSOLE_PUTCHAR_FID, SBI_CONSOLE_PUTCHAR_EXT)
SBICALL_FUNC(sbi_console_getchar, SBI_CONSOLE_GETCHAR_FID, SBI_CONSOLE_GETCHAR_EXT)
SBICALL_FUNC(sbi_clear_ipi, SBI_CLEAR_IPI_FID, SBI_CLEAR_IPI_EXT)
SBICALL_FUNC(sbi_send_ipi, SBI_SEND_IPI_FID, SBI_SEND_IPI_EXT)
SBICALL_FUNC(sbi_remote_fence_i, SBI_REMOTE_FENCE_I_FID, SBI_REMOTE_FENCE_I_EXT)
SBICALL_FUNC(sbi_remote_sfence_vma, SBI_REMOTE_SFENCE_VMA_FID, SBI_REMOTE_SFENCE_VMA_EXT)
SBICALL_FUNC(sbi_remote_sfence_vma_asid, SBI_REMOTE_SFENCE_VMA_ASID_FID, SBI_REMOTE_SFENCE_VMA_ASID_EXT)
SBICALL_FUNC(sbi_shutdown, SBI_SHUTDOWN_FID, SBI_SHUTDOWN_EXT)
SBICALL_FUNC(sbi_remote_hfence_gvma_vmid, SBI_REMOTE_HFENCE_GVMA_VMID_FID, SBI_REMOTE_HFENCE_GVMA_VMID_EXT)
SBICALL_FUNC(sbi_remote_hfence_gvma, SBI_REMOTE_HFENCE_GVMA_FID, SBI_REMOTE_HFENCE_GVMA_EXT)
SBICALL_FUNC(sbi_remote_hfence_vvma_asid, SBI_REMOTE_HFENCE_VVMA_ASID_FID, SBI_REMOTE_HFENCE_VVMA_ASID_EXT)
SBICALL_FUNC(sbi_remote_hfence_vvma, SBI_REMOTE_HFENCE_VVMA_FID, SBI_REMOTE_HFENCE_VVMA_EXT)
SBICALL_FUNC(sbi_hart_start, SBI_HART_START_FID, SBI_HART_START_EXT)
SBICALL_FUNC(sbi_hart_stop, SBI_HART_STOP_FID, SBI_HART_STOP_EXT)
SBICALL_FUNC(sbi_hart_get_status, SBI_HART_GET_STATUS_FID, SBI_HART_GET_STATUS_EXT)
